"Free Text" "/*Home 40(-4)  - Move positive until mechanical limit is reached. Stop when home threshold current is reached for an imposed time and move away from the limit with the absolute value or Home position variable. */\r\n/* In case of Stepper Open Loop control + encoder configuration, the homing is based on the position control error set in Setup and the Current threshold time value. */" 
	Start "Save ASR, LSACTIVE and TERRMAX value in order to disable Software Limit Switches" 
	"A 32-bit Long or Fixed" "Type=1 Destination=PROD Source=ASR 32BitPart=0" 
	"A 32-bit Long or Fixed" "Type=1 Destination=PROD Source=LSACTIVE 32BitPart=1" 
	"A 32-bit Long or Fixed" "Type=1 Destination=var_lf Source=0 32BitPart=1" 
	"A 32-bit Long or Fixed" "Type=1 Destination=PRODH Source=TERRMAX 32BitPart=1" 
	"A 16-bit Integer" "Type=0 Destination=LSACTIVE SetVarType=0 Source=1" 
	"A 16-bit Integer" "Type=0 Destination=asr SetVarType=4 AND=EFFF OR=0" 
	End
	Start "Setting parameters And StartMotion" 
	"A 32-bit Long or Fixed" "Type=1 Destination=var_lf Source=HOMETIME 32BitPart=0" 
	"A 16-bit Integer" "Type=0 Destination=TERRMAX SetVarType=0 Source=0xFFFF" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_HomeCrt_GT0_f Variable=homecrt Condition=5" 
	"A 16-bit Integer" "Type=0 Destination=HOMECRT SetVarType=0 Source=-HOMECRT" 
	"Jumps and Function Calls" "Type=6 Label=H40_TSH37_HomeCrt_GT0_f" 
		Start "Is Homing Number EVEN ?" 
		"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=homing_nr" 
		"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=4 AND=1 OR=0" 
			Start "If negative transmission, reverse position command" 
			"Jumps and Function Calls" "Type=0 Label=H40_TSH37_NoNeg1_Transm Variable=Transmission Condition=5" 
			"Jumps and Function Calls" "Type=0 Label=H40_TSH37_Homing_ODD_Init Variable=var_i3 Condition=0" 
			"Jumps and Function Calls" "Type=0 Label=H40_TSH37_Homing_Mode_37_Init" 
			"Jumps and Function Calls" "Type=6 Label=H40_TSH37_NoNeg1_Transm" 
			End
		"Jumps and Function Calls" "Type=0 Label=H40_TSH37_Homing_Mode_37_Init Variable=var_i3 Condition=0" 
		End
		Start "Homing Number Is ODD" 
		"Jumps and Function Calls" "Type=6 Label=H40_TSH37_Homing_ODD_Init" 
		"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=-1000000000 SetVarType=0" 
		"Trapezoidal Profiles" "Profile=0 Type=1 Additive=0 StartPoint=0 Execute=0 WaitForCompletion=0" 
			Start "If StepperOpenLoop configuration, use Wait HardStop Poserr Neg, if not, use Wait Current Neg" 
				Start "If not stepper use Wait Current Neg" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=0 Source=SCR" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=4 AND=4000 OR=0" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitCurrent_NegMot Variable=var_i2 Condition=0" 
				End
				Start "If not SCL use Wait Current Neg" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=0 Source=OSR" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=4 AND=400 OR=0" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitCurrent_NegMot Variable=var_i2 Condition=3" 
				End
				Start "If SOL + enc on load use Wait HardStop Poserr Neg" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=0 Source=OSR" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=4 AND=1000 OR=0" 
				"Jumps and Function Calls" "Type=3" disabled
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitPosERR_Negative Variable=var_i2 Condition=3" 
				End
				Start "Current config SOL + enc on motor ==> use Wait HardStop Poserr Positive" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitPosERR_Positive" 
				End
			End
		End
		Start "Homing Number is EVEN" 
		"Jumps and Function Calls" "Type=6 Label=H40_TSH37_Homing_Mode_37_Init" 
		"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=1000000000 SetVarType=0" 
		"Trapezoidal Profiles" "Profile=0 Type=1 Additive=0 StartPoint=0 Execute=0 WaitForCompletion=0" 
			Start "If StepperOpenLoop configuration, use Wait HardStop Poserr Pos, if not, use Wait Current Pos" 
				Start "If not stepper use Wait Current Pos" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=0 Source=SCR" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=4 AND=4000 OR=0" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitCurrent_PosMot Variable=var_i2 Condition=0" 
				End
				Start "If not SCL use Wait Current Pos" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=0 Source=OSR" 
				"A 16-bit Integer" "Type=0 Destination=var_i2 SetVarType=4 AND=400 OR=0" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitCurrent_PosMot Variable=var_i2 Condition=3" 
				End
				Start "Current config SOL ==> use Wait HardStop Poserr Pos" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitPosERR_Positive" 
				End
			End
		End
	End
"Jumps and Function Calls" "Type=6 Label=H40_TSH37_waitCurrent_NegMot" 
	Start "Wait for hardstop NegMot" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=HOMECRT" 
	"Arithmetic Operations" "Type=0 Operand1=var_i3 Operand2=IQREF" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitCurrent_NegMot Variable=var_i3 Condition=2" 
	"Events" "Stop=0 Wait=1 EvType=4 EvSourceType=1 EvSrcVar=var_lf" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=HOMECRT" 
	"Arithmetic Operations" "Type=0 Operand1=var_i3 Operand2=IQREF" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitCurrent_NegMot Variable=var_i3 Condition=2" 
	End
"Jumps and Function Calls" "Type=0 Label=H40_TSH37_StopMotion" 
"Jumps and Function Calls" "Type=6 Label=H40_TSH37_waitCurrent_PosMot" 
	Start "Wait for hardstop PosMot" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=HOMECRT" 
	"Arithmetic Operations" "Type=1 Operand1=var_i3 Operand2=IQREF" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitCurrent_PosMot Variable=var_i3 Condition=2" 
	"Events" "Stop=0 Wait=1 EvType=4 EvSourceType=1 EvSrcVar=var_lf" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=HOMECRT" 
	"Arithmetic Operations" "Type=1 Operand1=var_i3 Operand2=IQREF" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitCurrent_PosMot Variable=var_i3 Condition=2" 
	End
"Jumps and Function Calls" "Type=0 Label=H40_TSH37_StopMotion" 
"Jumps and Function Calls" "Type=6 Label=H40_TSH37_waitPosERR_Negative" 
	Start "Wait for hardstop POSERR Negative" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=ERRMAX" 
	"Arithmetic Operations" "Type=0 Operand1=var_i3 Operand2=POSERR" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitPosERR_Negative Variable=var_i3 Condition=2" 
	"Events" "Stop=0 Wait=1 EvType=4 EvSourceType=1 EvSrcVar=var_lf" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=ERRMAX" 
	"Arithmetic Operations" "Type=0 Operand1=var_i3 Operand2=POSERR" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitPosERR_Negative Variable=var_i3 Condition=2" 
	End
"Jumps and Function Calls" "Type=0 Label=H40_TSH37_StopMotion" 
"Jumps and Function Calls" "Type=6 Label=H40_TSH37_waitPosERR_Positive" 
	Start "Wait for hardstop POSERR Positive" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=ERRMAX" 
	"Arithmetic Operations" "Type=1 Operand1=var_i3 Operand2=POSERR" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitPosERR_Positive Variable=var_i3 Condition=2" 
	"Events" "Stop=0 Wait=1 EvType=4 EvSourceType=1 EvSrcVar=var_lf" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=ERRMAX" 
	"Arithmetic Operations" "Type=1 Operand1=var_i3 Operand2=POSERR" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_waitPosERR_Positive Variable=var_i3 Condition=2" 
	End
	Start "Quick STOP ( StopMotion)" 
	"Jumps and Function Calls" "Type=6 Label=H40_TSH37_StopMotion" 
	"A 16-bit Integer" "Type=0 Destination=quickstops SetVarType=0 Source=1" 
	"Free Text" "  !MC; WAIT!; // wait for completion" 
	End
	Start "Wait for first index transition(37,38) or stop at current position(39,40) - homepos" 
	"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=homing_nr" 
	"Arithmetic Operations" "Type=1 Operand1=var_i3 Operand2=39" 
	"Jumps and Function Calls" "Type=0 Label=H40_TSH37_homing_39_or_40 Variable=var_i3 Condition=5" 
		Start "Homing 37 or 38" 
			Start "Reverse Motion" 
			"A 16-bit Integer" "Type=0 Destination=ASR SetVarType=4 AND=FFFF OR=48" 
			"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=-CPOS SetVarType=0" 
			"A 32-bit Long or Fixed" "Type=0 Destination=CSPD Source=HOMESPD SetVarType=0" 
			"Trapezoidal Profiles" "Profile=0 Type=1 StartPoint=1 Execute=0 WaitForCompletion=0" 
			End
			Start "TSH37 Waitindex" 
			"Jumps and Function Calls" "Type=6 Label=H40_TSH37_Waitindex" 
				Start "Capture position on index pulse 1 or 2 and put it in CAPPOS variable" 
					Start "Determine if index pulse is on Feedback\d2" 
					"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=SCR" 
					"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=4 AND=400 OR=0" 
					"Jumps and Function Calls" "Type=0 Label=H40_THS37_Waitindex_onFDBK2 Variable=var_i3 Condition=2" 
					End
					Start "Capture the index pulse of Feedback \d1" 
					"Events" "Stop=0 Wait=1 EvType=6 EvInput=0 EvInputLevel=1" 
					"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=CAPPOS SetVarType=0" 
					"Jumps and Function Calls" "Type=0 Label=H40_THS37_Waitindex_onFDBK1" 
					End
					Start "Capture the index pulse of Feedback \d2" 
					"Jumps and Function Calls" "Type=6 Label=H40_THS37_Waitindex_onFDBK2" 
					"Events" "Stop=0 Wait=1 EvType=6 EvInput=0 EvInputLevel=1" 
					"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=CAPPOS SetVarType=0" 
					"Jumps and Function Calls" "Type=6 Label=H40_THS37_Waitindex_onFDBK1" 
					End
				End
			"A 32-bit Long or Fixed" "Type=0 Destination=CSPD Source=HOMESPD SetVarType=0" 
			"Trapezoidal Profiles" "Profile=0 Type=0 StartPoint=0 Execute=0 WaitForCompletion=1" 
			End
		"Jumps and Function Calls" "Type=0 Label=H40_TSH37_exit_homing" 
		End
		Start "Homing 39 or 40" 
		"Jumps and Function Calls" "Type=6 Label=H40_TSH37_homing_39_or_40" 
			Start "Determine homing_nr parity" 
			"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=0 Source=homing_nr" 
			"A 16-bit Integer" "Type=0 Destination=var_i3 SetVarType=4 AND=1 OR=0" 
				Start "If negative transmission, reverse position command" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_NoNeg2_Transm Variable=Transmission Condition=5" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_Homing_ODD2 Variable=var_i3 Condition=0" 
				"Jumps and Function Calls" "Type=0 Label=H40_TSH37_Homing_nr_even_f" 
				"Jumps and Function Calls" "Type=6 Label=H40_TSH37_NoNeg2_Transm" 
				End
			"Jumps and Function Calls" "Type=0 Label=H40_TSH37_Homing_nr_even_f Variable=var_i3 Condition=0" 
			End
			Start "Homing Number Is ODD" 
			"Jumps and Function Calls" "Type=6 Label=H40_TSH37_Homing_ODD2" 
			"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=HOMEPOS SetVarType=0" 
			"Jumps and Function Calls" "Type=0 Label=H40_TSH37_MoveAway_f Variable=CPOS Condition=5" 
			"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=-HOMEPOS SetVarType=0" 
			"Jumps and Function Calls" "Type=0 Label=H40_TSH37_MoveAway_f" 
			End
			Start "Homing Number is EVEN" 
			"Jumps and Function Calls" "Type=6 Label=H40_TSH37_Homing_nr_even_f" 
			"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=HOMEPOS SetVarType=0" 
			"Jumps and Function Calls" "Type=0 Label=H40_TSH37_MoveAway_f Variable=CPOS Condition=1" 
			"A 32-bit Long or Fixed" "Type=0 Destination=CPOS Source=-HOMEPOS SetVarType=0" 
			End
			Start "Move away from limit by absolute  value of HOMEPOS" 
			"Jumps and Function Calls" "Type=6 Label=H40_TSH37_MoveAway_f" 
			"A 16-bit Integer" "Type=0 Destination=ASR SetVarType=4 AND=FFFF OR=48" 
			"A 32-bit Long or Fixed" "Type=0 Destination=CSPD Source=HOMESPD SetVarType=0" 
				Start "Reset actual position to 0" 
				"Motor Commands" "Type=5 CPOS=0" 
				End
			"Trapezoidal Profiles" "Profile=0 Type=1 StartPoint=1 Execute=0 WaitForCompletion=1" 
			End
		End
	End
	Start "Exit homing" 
	"Jumps and Function Calls" "Type=6 Label=H40_TSH37_exit_homing" 
	"Motor Commands" "Type=5 SrcVar=HOMEPOS" 
		Start "Restore ASR and LSACTIVE and TERRMAX" 
		"A 16-bit Integer" "Type=0 Destination=asr SetVarType=2 32BitPart=0 Source=PROD" 
		"A 16-bit Integer" "Type=0 Destination=LSACTIVE SetVarType=2 32BitPart=1 Source=PROD" 
		"A 16-bit Integer" "Type=0 Destination=TERRMAX SetVarType=2 32BitPart=1 Source=PRODH" 
		End
	End
